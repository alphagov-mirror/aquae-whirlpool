#!/usr/bin/env ruby
require_relative  '../lib/whirlpool'

config_file, log_dir, _ = ARGV
config = Whirlpool::Configuration.new config_file
logger = Logger.new File.join(log_dir || '.', "#{config.this_node.name}.log.txt")
logger.formatter = proc do |severity, datetime, progname, msg|
  "#{severity.ljust(5)} [#{config.this_node.name}] (#{datetime.strftime('%s%6N')}): #{msg}\n"
end
app = Whirlpool::Application.new config, logger

begin
  app.start!
ensure
  logger.close
end
